/*global define: false */define(["lodash","underscore.string","app"],function(e,t,n){"use strict";return["$scope","$log","$location","$routeParams","music","socket","tableServices","playerServices",function(t,n,r,i,s,o,u,a){t.game.table=t.game.table||{};t.game.round=t.game.round||{};t.game.round.active=!0;t.game.playerOrderPredicate="lastJoined";if(i.sessionId){var f=u.getTableWithSession(i.sessionId);f.then(function(e){n.log("tableServices getTableWithSession response:",e);t.game.table=e.data;l();t.$apply()},function(e){n.log("tableServices getTableWithSession error:",e)})}t.displayRoundInfo=function(){var e=!0;if(!t.game.table)e=!1;else if(!t.game.table.players||t.game.table.players.length<=1)e=!1;n.log("should display table? ",e);return e};o.on("game:player:joined",function(e){console.log("after player joined:",e);if(e.error)n.error(e.error);else{t.game.table=e.table;l()}});s.pauseCurrent();var l=function(){var r=a.getPlayersOnTable(t.game.table._id);r.then(function(r){n.log("playerServices getPlayersOnTable response:",r);if(e.isEmpty(t.game.players))t.game.players=r.data;else{var i=e.pluck(r.data,"_id"),s=e.pluck(t.game.players,"_id"),o=e.difference(i,s);e.each(r.data,function(n){e.contains(o,n._id)&&t.game.players.push(n)})}t.$apply()},function(e){n.log("playerServices getPlayersOnTable error:",e)})};t.$apply()}]});